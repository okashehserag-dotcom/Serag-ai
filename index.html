<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Navy English Tutor â€” Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©</title>

  <style>
    :root{
      --bg:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --card:#ffffff;
      --border:#e2e8f0;
      --shadow: 0 10px 30px rgba(15, 23, 42, .08);
      --navy:#0b2a5b;
      --blue:#1d4ed8;
      --blue2:#2563eb;
      --soft:#f5f8ff;
      --ok:#16a34a;
      --bad:#dc2626;
      --warn:#f59e0b;
      --radius:16px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial;
      background: var(--bg);
      color: var(--text);
    }

    /* Top bar */
    header{
      position:sticky; top:0; z-index:10;
      background: rgba(255,255,255,.9);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--border);
    }
    .top{
      max-width:1100px;
      margin:auto;
      padding:14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:900;
      letter-spacing:.2px;
    }
    .logo{
      width:38px; height:38px;
      border-radius:12px;
      background: linear-gradient(135deg, var(--navy), var(--blue));
      box-shadow: 0 10px 20px rgba(29,78,216,.25);
      display:grid; place-items:center;
      color:#fff;
      font-weight:900;
      user-select:none;
    }
    .sub{
      font-size:12px;
      color: var(--muted);
      font-weight:700;
      margin-top:2px;
    }
    .right-top{
      display:flex; align-items:center; gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .pill{
      font-size:12px;
      color: var(--navy);
      background: var(--soft);
      border:1px solid #dbeafe;
      padding:6px 10px;
      border-radius:999px;
      font-weight:800;
    }
    .ghost{
      background:#fff;
      border:1px solid var(--border);
      color: var(--navy);
      padding:8px 10px;
      border-radius:12px;
      font-weight:800;
      cursor:pointer;
      transition:.18s;
    }
    .ghost:hover{ transform: translateY(-1px); box-shadow: var(--shadow); }

    /* Tabs */
    .tabsWrap{
      max-width:1100px;
      margin:0 auto 8px;
      padding:0 16px 14px;
      display:none; /* hidden until onboarding done */
    }
    .tabs{
      background: var(--navy);
      border-radius: 16px;
      padding:8px;
      display:flex;
      gap:8px;
      overflow:auto;
      box-shadow: 0 12px 28px rgba(11,42,91,.18);
    }
    .tab{
      border:0;
      padding:10px 12px;
      border-radius:12px;
      background: transparent;
      color: rgba(255,255,255,.85);
      font-weight:900;
      cursor:pointer;
      white-space:nowrap;
      transition:.18s;
    }
    .tab:hover{ background: rgba(255,255,255,.10); }
    .tab.active{
      background: linear-gradient(135deg, var(--blue), var(--blue2));
      color:#fff;
      box-shadow: 0 10px 18px rgba(37,99,235,.35);
    }

    /* Layout */
    main{
      max-width:1100px;
      margin:auto;
      padding:18px 16px 60px;
    }
    .grid{
      display:grid;
      grid-template-columns: 1.3fr .7fr;
      gap:14px;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
    }

    /* Card */
    .card{
      background: var(--card);
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:16px;
    }
    .cardTitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .cardTitle h2, .cardTitle h3{
      margin:0;
      font-size:16px;
      font-weight:900;
      color: var(--navy);
    }
    .muted{ color: var(--muted); font-weight:700; font-size:13px; line-height:1.6; }
    .hr{ height:1px; background: var(--border); margin:12px 0; }

    /* Buttons */
    .btn{
      border:0;
      border-radius:14px;
      padding:10px 12px;
      font-weight:900;
      cursor:pointer;
      background: linear-gradient(135deg, var(--blue), var(--blue2));
      color:#fff;
      transition:.18s;
      box-shadow: 0 12px 22px rgba(37,99,235,.22);
    }
    .btn:hover{ transform: translateY(-1px); opacity:.95; }
    .btn.secondary{
      background:#fff;
      border:1px solid var(--border);
      color: var(--navy);
      box-shadow:none;
    }
    .btn.secondary:hover{ box-shadow: var(--shadow); }

    /* Inputs */
    input, select, textarea{
      width:100%;
      border:1px solid var(--border);
      padding:10px 12px;
      border-radius:14px;
      outline:none;
      font-weight:800;
      color: var(--text);
      background:#fff;
    }
    textarea{ min-height:90px; resize:vertical; }
    label{
      display:block;
      font-size:12px;
      font-weight:900;
      color: var(--navy);
      margin:10px 0 6px;
    }

    /* Views + animation */
    .view{ display:none; }
    .view.active{
      display:block;
      animation: slideFade .35s ease;
    }
    @keyframes slideFade{
      from{ opacity:0; transform: translateY(10px); }
      to{ opacity:1; transform: translateY(0); }
    }

    /* Stepper */
    .stepper{
      display:flex; gap:8px; flex-wrap:wrap;
      margin:10px 0 0;
    }
    .stepDot{
      flex:1;
      min-width:90px;
      height:10px;
      border-radius:999px;
      background:#e5e7eb;
      overflow:hidden;
      position:relative;
    }
    .stepDot > span{
      display:block;
      height:100%;
      width:0%;
      background: linear-gradient(135deg, var(--blue), var(--blue2));
      transition: width .35s ease;
    }

    /* Question options */
    .option{
      border:1px solid var(--border);
      border-radius:14px;
      padding:12px;
      margin-top:10px;
      cursor:pointer;
      transition:.15s;
      background:#fff;
      font-weight:900;
      color: var(--text);
    }
    .option:hover{
      transform: translateY(-1px);
      box-shadow: var(--shadow);
      border-color:#c7d2fe;
    }
    .option small{ display:block; color:var(--muted); font-weight:800; margin-top:6px; }
    .option.correct{ border-color:#86efac; background:#f0fdf4; }
    .option.wrong{ border-color:#fecaca; background:#fef2f2; }

    /* Progress bar */
    .bar{
      width:100%;
      height:12px;
      background:#e5e7eb;
      border-radius:999px;
      overflow:hidden;
    }
    .bar > div{
      height:100%;
      width:0%;
      background: linear-gradient(135deg, var(--ok), #22c55e);
      transition: width .45s ease;
    }

    /* English snippets */
    .en{
      direction:ltr;
      unicode-bidi: plaintext;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Arial;
    }
    .badge{
      display:inline-flex; align-items:center; gap:6px;
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--border);
      background:#fff;
      font-size:12px; font-weight:900;
      color: var(--navy);
    }

    /* Tiny list */
    ul.clean{
      margin:10px 0 0; padding:0 18px;
      color: var(--text);
      font-weight:800;
      line-height:1.7;
    }

    /* Session step */
    .sessionStep{
      border:1px dashed #cbd5e1;
      border-radius:16px;
      padding:14px;
      background:#fff;
    }

    /* Toast */
    .toast{
      position:fixed;
      bottom:14px;
      left:14px;
      right:14px;
      max-width:1100px;
      margin:auto;
      display:none;
      z-index:50;
    }
    .toast .card{
      border-radius:18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:12px 14px;
    }
    .toastMsg{
      font-weight:900;
      color: var(--navy);
    }
    .toast.show{ display:block; animation: slideFade .25s ease; }

    /* Footer note */
    .note{
      font-size:12px;
      color: var(--muted);
      font-weight:800;
      margin-top:10px;
      line-height:1.6;
    }
  </style>
</head>

<body>
<header>
  <div class="top">
    <div>
      <div class="brand">
        <div class="logo">EN</div>
        <div>
          <div>Navy English Tutor</div>
          <div class="sub">ØªØ­Ø¯ÙŠØ¯ Ù…Ø³ØªÙˆÙ‰ â†’ Ù‡Ø¯Ù â†’ Ø®Ø·Ø© â†’ ØªØ¹Ù„Ù‘Ù… Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©</div>
        </div>
      </div>
    </div>
    <div class="right-top">
      <span class="pill" id="pillStatus">ØºÙŠØ± Ù…ÙØ¹Ø¯</span>
      <button class="ghost" id="btnReset" title="Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· ÙƒÙ„ Ø´ÙŠØ¡">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
    </div>
  </div>

  <div class="tabsWrap" id="tabsWrap">
    <div class="tabs" id="tabs">
      <button class="tab active" data-tab="today">Ø¬Ù„Ø³Ø© Ø§Ù„ÙŠÙˆÙ…</button>
      <button class="tab" data-tab="plan">Ø§Ù„Ø®Ø·Ø©</button>
      <button class="tab" data-tab="learn">Ø§Ù„ØªØ¹Ù„Ù‘Ù…</button>
      <button class="tab" data-tab="practice">Ø§Ù„ØªØ¯Ø±ÙŠØ¨</button>
      <button class="tab" data-tab="progress">Ø§Ù„ØªÙ‚Ø¯Ù‘Ù…</button>
    </div>
  </div>
</header>

<main>

  <!-- ONBOARDING (Step by Step) -->
  <section class="view active" id="viewOnboarding">

    <div class="card">
      <div class="cardTitle">
        <h2>ğŸ‘‹ Ø®Ù„Ù‘ÙŠÙ†Ø§ Ù†Ø¨Ø¯Ø£ Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©</h2>
        <span class="badge" id="stepLabel">Ø§Ù„Ø®Ø·ÙˆØ© 1/4</span>
      </div>
      <div class="muted">Ø±Ø§Ø­ Ù†Ø³Ø£Ù„Ùƒ Ø£Ø³Ø¦Ù„Ø© Ø¨Ø³ÙŠØ·Ø©ØŒ Ù†Ø­Ø¯Ø¯ Ù…Ø³ØªÙˆØ§Ùƒ (CEFR) + Ù‡Ø¯ÙÙƒ + ÙˆÙ‚ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ÙŠØŒ ÙˆØ¨Ø¹Ø¯Ù‡Ø§ Ù†Ø¹Ù…Ù„ Ø®Ø·Ø© ÙˆÙ†Ø¨Ø¯Ø£ Ø§Ù„Ø¯Ø±Ø³ Ù…Ø¨Ø§Ø´Ø±Ø©.</div>

      <div class="stepper" aria-label="progress">
        <div class="stepDot"><span id="dot1"></span></div>
        <div class="stepDot"><span id="dot2"></span></div>
        <div class="stepDot"><span id="dot3"></span></div>
        <div class="stepDot"><span id="dot4"></span></div>
      </div>

      <div class="hr"></div>

      <!-- Step 1 -->
      <div id="step1" class="view active">
        <label>Ø§Ø³Ù…Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input id="inpName" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯" />

        <label>ÙƒÙ… Ø¯Ù‚ÙŠÙ‚Ø© ØªÙ‚Ø¯Ø± ØªØ¯Ø±Ø³ ÙŠÙˆÙ…ÙŠÙ‹Ø§ØŸ</label>
        <select id="inpMinutes">
          <option value="15">15 Ø¯Ù‚ÙŠÙ‚Ø©</option>
          <option value="25">25 Ø¯Ù‚ÙŠÙ‚Ø©</option>
          <option value="30" selected>30 Ø¯Ù‚ÙŠÙ‚Ø©</option>
          <option value="45">45 Ø¯Ù‚ÙŠÙ‚Ø©</option>
          <option value="60">60 Ø¯Ù‚ÙŠÙ‚Ø©</option>
        </select>

        <div class="note">âœ¨ Ø§Ù„Ø®Ø·Ø© Ø¨ØªØªØºÙŠØ± Ø­Ø³Ø¨ ÙˆÙ‚ØªÙƒ: ÙƒÙ„ Ù…Ø§ Ø²Ø§Ø¯ Ø§Ù„ÙˆÙ‚ØªØŒ Ø¨Ù†Ø²ÙŠØ¯ Ù…Ø­Ø§Ø¯Ø«Ø© ÙˆØªØ·Ø¨ÙŠÙ‚ Ø¹Ù…Ù„ÙŠ.</div>

        <div style="display:flex; gap:10px; margin-top:12px; justify-content:flex-start;">
          <button class="btn" id="goStep2">Ø§Ù„ØªØ§Ù„ÙŠ â†’</button>
        </div>
      </div>

      <!-- Step 2 -->
      <div id="step2" class="view">
        <label>Ù‡Ø¯ÙÙƒ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù…Ù† ØªØ¹Ù„Ù‘Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</label>
        <select id="inpGoal">
          <option value="conversation">Ù…Ø­Ø§Ø¯Ø«Ø© ÙŠÙˆÙ…ÙŠØ©</option>
          <option value="travel">Ø§Ù„Ø³ÙØ±</option>
          <option value="job">Ø§Ù„Ø¹Ù…Ù„ / Ù…Ù‚Ø§Ø¨Ù„Ø§Øª</option>
          <option value="study">Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</option>
          <option value="exam">Ø§Ø®ØªØ¨Ø§Ø± (IELTS/TOEFL) - Ù…Ø¨Ø§Ø¯Ø¦</option>
        </select>

        <label>ÙˆØ´ Ø£ÙƒØ«Ø± Ø´ÙŠ ÙŠØ²Ø¹Ø¬Ùƒ Ø­Ø§Ù„ÙŠÙ‹Ø§ØŸ</label>
        <select id="inpPain">
          <option value="speaking">Ø§Ù„ØªØ­Ø¯Ø« (Ø£Ø®Ø§Ù Ø£ØºÙ„Ø·)</option>
          <option value="listening">Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ (Ù…Ø§ Ø¨Ù„Ø­Ù‚)</option>
          <option value="grammar">Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ (ØªÙ„Ø®Ø¨Ø·Ù†ÙŠ)</option>
          <option value="vocab">Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª (Ø£Ù†Ø³Ù‰ Ø¨Ø³Ø±Ø¹Ø©)</option>
        </select>

        <div style="display:flex; gap:10px; margin-top:12px;">
          <button class="btn secondary" id="back1">â† Ø±Ø¬ÙˆØ¹</button>
          <button class="btn" id="goStep3">Ø§Ø¨Ø¯Ø£ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø³ØªÙˆÙ‰ â†’</button>
        </div>
      </div>

      <!-- Step 3 (Placement Test) -->
      <div id="step3" class="view">
        <div class="muted">Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹ (12 Ø³Ø¤Ø§Ù„). Ø§Ø®ØªØ§Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø£ÙØ¶Ù„ âœ…</div>

        <div class="card" style="margin-top:12px; box-shadow:none;">
          <div class="cardTitle">
            <h3 id="qTitle">Ø§Ù„Ø³Ø¤Ø§Ù„</h3>
            <span class="badge" id="qCount">1/12</span>
          </div>
          <div class="muted" id="qHint"></div>

          <div class="hr"></div>

          <div id="qOptions"></div>

          <div style="display:flex; gap:10px; margin-top:12px;">
            <button class="btn secondary" id="qPrev">â† Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
            <button class="btn" id="qNext">Ø§Ù„ØªØ§Ù„ÙŠ â†’</button>
          </div>

          <div class="note">ğŸ’¡ Ù†ØµÙŠØ­Ø©: Ù„Ø§ ØªØªÙˆØªØ±. Ø§Ù„ÙÙƒØ±Ø© Ù†Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø¹Ø´Ø§Ù† Ø§Ù„Ø®Ø·Ø© ØªÙƒÙˆÙ† Ù…Ù†Ø§Ø³Ø¨Ø©.</div>
        </div>
      </div>

      <!-- Step 4 (Result) -->
      <div id="step4" class="view">
        <div class="cardTitle">
          <h2>ğŸ“Œ Ù†ØªÙŠØ¬ØªÙƒ + Ø®Ø·Ø© Ø¬Ø§Ù‡Ø²Ø©</h2>
          <span class="badge" id="levelBadge">A1</span>
        </div>

        <div class="muted" id="resultText"></div>

        <div class="hr"></div>

        <div class="grid">
          <div class="card" style="box-shadow:none;">
            <div class="cardTitle">
              <h3>ğŸ—ºï¸ Ø®Ø·ØªÙƒ (4 Ø£Ø³Ø§Ø¨ÙŠØ¹)</h3>
              <span class="badge" id="planBadge">30 Ø¯Ù‚ÙŠÙ‚Ø©/ÙŠÙˆÙ…</span>
            </div>
            <div id="planBox"></div>
          </div>

          <div class="card" style="box-shadow:none;">
            <div class="cardTitle">
              <h3>ğŸ¯ ØªØ±ÙƒÙŠØ²Ùƒ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>
              <span class="badge" id="focusBadge">Balanced</span>
            </div>

            <div class="muted" style="margin-bottom:10px;">ØªÙˆØ²ÙŠØ¹ ÙˆÙ‚ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ÙŠ:</div>

            <div style="display:grid; gap:10px;">
              <div>
                <div class="muted" style="display:flex; justify-content:space-between;">
                  <span>Ù…ÙØ±Ø¯Ø§Øª</span><span id="pVocab">0%</span>
                </div>
                <div class="bar"><div id="barVocab"></div></div>
              </div>
              <div>
                <div class="muted" style="display:flex; justify-content:space-between;">
                  <span>Ù‚ÙˆØ§Ø¹Ø¯</span><span id="pGrammar">0%</span>
                </div>
                <div class="bar"><div id="barGrammar"></div></div>
              </div>
              <div>
                <div class="muted" style="display:flex; justify-content:space-between;">
                  <span>Ø§Ø³ØªÙ…Ø§Ø¹/Ù†Ø·Ù‚</span><span id="pListen">0%</span>
                </div>
                <div class="bar"><div id="barListen"></div></div>
              </div>
              <div>
                <div class="muted" style="display:flex; justify-content:space-between;">
                  <span>Ù…Ø­Ø§Ø¯Ø«Ø©/ØªØ·Ø¨ÙŠÙ‚</span><span id="pSpeak">0%</span>
                </div>
                <div class="bar"><div id="barSpeak"></div></div>
              </div>
            </div>
          </div>
        </div>

        <div style="display:flex; gap:10px; margin-top:12px;">
          <button class="btn secondary" id="backToTest">â† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
          <button class="btn" id="finishOnboarding">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ¹Ù„Ù‘Ù… Ø§Ù„Ø¢Ù† ğŸš€</button>
        </div>
      </div>

    </div>
  </section>

  <!-- DASHBOARD -->
  <section class="view" id="viewDashboard">
    <div class="grid">

      <!-- Main pane -->
      <div class="card">
        <div class="cardTitle">
          <h2 id="dashTitle">Ø¬Ù„Ø³Ø© Ø§Ù„ÙŠÙˆÙ…</h2>
          <span class="badge" id="dashMeta">â€”</span>
        </div>

        <!-- Today session -->
        <div id="tab_today" class="tabView">
          <div class="muted">Ø¬Ù„Ø³Ø© Ø®Ø·ÙˆØ©-Ø¨Ø®Ø·ÙˆØ©: Ù…Ø§ Ø¨ØªÙ†ØªÙ‚Ù„ Ù„Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ù„ÙŠ Ø¨Ø¹Ø¯Ù‡Ø§ Ø¥Ù„Ø§ Ù„Ù…Ø§ ØªØ®Ù„Øµ Ø§Ù„Ù„ÙŠ Ù‚Ø¨Ù„Ù‡Ø§ âœ…</div>
          <div class="hr"></div>

          <div class="sessionStep" id="sessionBox"></div>

          <div style="display:flex; gap:10px; margin-top:12px;">
            <button class="btn secondary" id="sessionBack">â† Ø±Ø¬ÙˆØ¹</button>
            <button class="btn" id="sessionNext">Ø§Ù„ØªØ§Ù„ÙŠ â†’</button>
          </div>

          <div class="note">ğŸ”Š Ø²Ø± â€œØ§Ø³ØªÙ…Ø¹â€ ÙŠØ³ØªØ®Ø¯Ù… Text-to-Speech ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­. Ø¥Ø°Ø§ Ù…Ø§ Ø§Ø´ØªØºÙ„ØŒ Ø¬Ø±Ù‘Ø¨Ù‡ Ø¹Ù„Ù‰ Chrome/Edge.</div>
        </div>

        <!-- Plan -->
        <div id="tab_plan" class="tabView" style="display:none;">
          <div class="muted">Ù‡Ø°Ù‡ Ø®Ø·ØªÙƒ Ø­Ø³Ø¨ Ù…Ø³ØªÙˆØ§Ùƒ ÙˆÙ‡Ø¯ÙÙƒ. ØªÙ‚Ø¯Ø± ØªÙ…Ø´ÙŠ Ø£Ø³Ø¨ÙˆØ¹ Ø£Ø³Ø¨ÙˆØ¹.</div>
          <div class="hr"></div>
          <div id="planFull"></div>
        </div>

        <!-- Learn -->
        <div id="tab_learn" class="tabView" style="display:none;">
          <div class="muted">Ø¯Ø±ÙˆØ³ Ù…ÙØµÙ„Ø©: Ù…ÙØ±Ø¯Ø§Øª + Ù‚ÙˆØ§Ø¹Ø¯ + Ù…Ø«Ø§Ù„ + Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ.</div>
          <div class="hr"></div>

          <div class="grid" style="grid-template-columns: 1fr 1fr;">
            <div class="card" style="box-shadow:none;">
              <div class="cardTitle">
                <h3>ğŸ“Œ Ø¯Ø±Ø³ Ø§Ù„ÙŠÙˆÙ… (Ù‚ÙˆØ§Ø¹Ø¯)</h3>
                <span class="badge" id="grammarTag">Grammar</span>
              </div>
              <div id="grammarLesson"></div>
              <label>Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ</label>
              <textarea id="notesArea" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù‡Ù†Ø§..."></textarea>
              <button class="btn secondary" id="saveNotes">Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</button>
            </div>

            <div class="card" style="box-shadow:none;">
              <div class="cardTitle">
                <h3>ğŸ§  Ø¨Ø·Ø§Ù‚Ø© Ù…ÙØ±Ø¯Ø§Øª</h3>
                <span class="badge" id="vocabTag">SRS</span>
              </div>
              <div id="flashcard"></div>
              <div style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;">
                <button class="btn secondary" id="btnSpeakWord">ğŸ”Š Ø§Ø³ØªÙ…Ø¹</button>
                <button class="btn" id="btnKnown">Ø¹Ø±ÙØªÙ‡Ø§ âœ…</button>
                <button class="btn secondary" id="btnHard">ØµØ¹Ø¨Ø© ğŸ¤¯</button>
              </div>
              <div class="note">ğŸ“Œ â€œØ¹Ø±ÙØªÙ‡Ø§â€ ÙŠØ¨Ø¹Ø¯Ù‡Ø§ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ù„Ø§Ø­Ù‚Ù‹Ø§ØŒ â€œØµØ¹Ø¨Ø©â€ ÙŠØ±Ø¬Ø¹Ù‡Ø§ Ù‚Ø±ÙŠØ¨.</div>
            </div>
          </div>
        </div>

        <!-- Practice -->
        <div id="tab_practice" class="tabView" style="display:none;">
          <div class="muted">ØªÙ…Ø§Ø±ÙŠÙ† ØªØ·Ø¨ÙŠÙ‚ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø± + ÙØ±Ø§ØºØ§Øª) Ù…Ø¹ ØªØµØ­ÙŠØ­ ÙÙˆØ±ÙŠ.</div>
          <div class="hr"></div>

          <div class="card" style="box-shadow:none;">
            <div class="cardTitle">
              <h3>ğŸ§© ØªÙ…Ø±ÙŠÙ† Ø³Ø±ÙŠØ¹</h3>
              <span class="badge" id="practiceCount">1/8</span>
            </div>
            <div id="practiceBox"></div>
            <div style="display:flex; gap:10px; margin-top:12px;">
              <button class="btn secondary" id="pracPrev">â† Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
              <button class="btn" id="pracNext">Ø§Ù„ØªØ§Ù„ÙŠ â†’</button>
            </div>
          </div>
        </div>

        <!-- Progress -->
        <div id="tab_progress" class="tabView" style="display:none;">
          <div class="muted">ØªÙ‚Ø¯Ù‘Ù…Ùƒ Ù…Ø­ÙÙˆØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ù…ØªØµÙØ­ âœ…</div>
          <div class="hr"></div>

          <div class="grid" style="grid-template-columns:1fr 1fr;">
            <div class="card" style="box-shadow:none;">
              <div class="cardTitle"><h3>ğŸ“ˆ Ù…Ù„Ø®Øµ</h3><span class="badge" id="streakBadge">Streak</span></div>
              <div id="progressSummary"></div>
            </div>
            <div class="card" style="box-shadow:none;">
              <div class="cardTitle"><h3>ğŸ“š ÙƒÙ„Ù…Ø§Øª Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</h3><span class="badge" id="dueBadge">Due</span></div>
              <div id="dueWords"></div>
            </div>
          </div>

          <div class="hr"></div>

          <button class="btn secondary" id="btnExport">ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§ØªÙŠ (JSON)</button>
          <div class="note" id="exportBox"></div>
        </div>
      </div>

      <!-- Side pane -->
      <aside class="card">
        <div class="cardTitle">
          <h3>ğŸ‘¤ Ù…Ù„ÙÙƒ</h3>
          <span class="badge" id="profileBadge">â€”</span>
        </div>

        <div class="muted" id="profileBox"></div>

        <div class="hr"></div>

        <div class="cardTitle">
          <h3>âœ… ØªÙ‚Ø¯Ù… Ø§Ù„ÙŠÙˆÙ…</h3>
          <span class="badge" id="todayBadge">0%</span>
        </div>
        <div class="bar"><div id="todayBar"></div></div>

        <div class="hr"></div>

        <div class="cardTitle">
          <h3>âš¡ Ø§Ø®ØªØµØ§Ø±Ø§Øª</h3>
          <span class="badge">Quick</span>
        </div>

        <div style="display:grid; gap:10px;">
          <button class="btn" id="jumpToday">Ø§Ø¨Ø¯Ø£ Ø¬Ù„Ø³Ø© Ø§Ù„ÙŠÙˆÙ…</button>
          <button class="btn secondary" id="jumpVocab">Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…ÙØ±Ø¯Ø§Øª Ø§Ù„Ø¢Ù†</button>
          <button class="btn secondary" id="jumpPractice">ØªÙ…Ø±ÙŠÙ† Ø³Ø±ÙŠØ¹ Ø§Ù„Ø¢Ù†</button>
        </div>

        <div class="note">ğŸ’™ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø®Ù„ÙÙŠØ© Ø¨ÙŠØ¶Ø§Ø¡ + ØªØ¨ÙˆÙŠØ¨Ø§Øª ÙƒØ­Ù„ÙŠ Ø²ÙŠ Ù…Ø§ Ø·Ù„Ø¨Øª.</div>
      </aside>

    </div>
  </section>

</main>

<div class="toast" id="toast">
  <div class="card">
    <div class="toastMsg" id="toastMsg">ØªÙ… âœ…</div>
    <button class="btn secondary" onclick="hideToast()">Ø­Ø³Ù†Ù‹Ø§</button>
  </div>
</div>

<script>
/* -----------------------------
   Simple "AI-like" Tutor App
   (Single-file, no libraries)
-------------------------------- */

const LS_KEY = "navy_english_tutor_v1";

const state = {
  onboardingStep: 1,
  profile: {
    name: "",
    minutes: 30,
    goal: "conversation",
    pain: "speaking",
    level: null, // A1/A2/B1/B2
    score: 0
  },
  placement: {
    index: 0,
    answers: Array(12).fill(null)
  },
  progress: {
    points: 0,
    streak: 0,
    lastDay: null,
    todayPercent: 0,
    sessionStep: 0,
    practiceIndex: 0,
    practiceAnswers: {}
  },
  notes: {
    grammar: ""
  },
  srs: {
    words: [] // {id, word, meaning, example, box, nextReviewTs}
  }
};

const intervalsDays = [0, 1, 3, 7, 14, 30]; // box 0..5

/* -----------------------------
   Content (Detailed)
-------------------------------- */
const GOALS_AR = {
  conversation: "Ù…Ø­Ø§Ø¯Ø«Ø© ÙŠÙˆÙ…ÙŠØ©",
  travel: "Ø§Ù„Ø³ÙØ±",
  job: "Ø§Ù„Ø¹Ù…Ù„ / Ù…Ù‚Ø§Ø¨Ù„Ø§Øª",
  study: "Ø§Ù„Ø¯Ø±Ø§Ø³Ø©",
  exam: "Ø§Ø®ØªØ¨Ø§Ø± (Ù…Ø¨Ø§Ø¯Ø¦)"
};

const PAIN_AR = {
  speaking: "Ø§Ù„ØªØ­Ø¯Ø«",
  listening: "Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹",
  grammar: "Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯",
  vocab: "Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª"
};

const LEVEL_DESC = {
  A1: "Ù…Ø¨ØªØ¯Ø¦: Ø¬ÙÙ…Ù„ Ø¨Ø³ÙŠØ·Ø© + Ù…ÙØ±Ø¯Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©.",
  A2: "Ø£Ø³Ø§Ø³ÙŠ Ù‚ÙˆÙŠ: Ø¬ÙÙ…Ù„ Ø£ÙƒØ«Ø± + Ù…ÙˆØ§Ù‚Ù ÙŠÙˆÙ…ÙŠØ©.",
  B1: "Ù…ØªÙˆØ³Ø·: ØªÙˆØ§ØµÙ„ Ø¹Ù…Ù„ÙŠ + ÙÙ‡Ù… Ù†ØµÙˆØµ Ø¨Ø³ÙŠØ·Ø©.",
  B2: "ÙÙˆÙ‚ Ù…ØªÙˆØ³Ø·: Ù…Ø­Ø§Ø¯Ø«Ø© Ø£Ø·ÙˆÙ„ + Ø¯Ù‚Ø© Ø£Ø¹Ù„Ù‰."
};

const placementQuestions = [
  // 12 questions, mixed difficulty, with hints
  { hint:"Ø£Ø³Ø§Ø³ÙŠØ§Øª", q:"Choose the correct sentence:", options:[
    {t:"I goes to work every day.", ok:false},
    {t:"I go to work every day.", ok:true},
    {t:"I am go to work every day.", ok:false}
  ]},
  { hint:"Ù…ÙØ±Ø¯Ø§Øª", q:"What does 'cheap' mean?", options:[
    {t:"Expensive", ok:false},
    {t:"Not expensive", ok:true},
    {t:"Dangerous", ok:false}
  ]},
  { hint:"Ù‚ÙˆØ§Ø¹Ø¯", q:"She ___ coffee.", options:[
    {t:"like", ok:false},
    {t:"likes", ok:true},
    {t:"liking", ok:false}
  ]},
  { hint:"Ø²Ù…Ù† Ù…Ø§Ø¶ÙŠ", q:"Past of 'eat' is:", options:[
    {t:"eated", ok:false},
    {t:"ate", ok:true},
    {t:"eat", ok:false}
  ]},
  { hint:"Ø­Ø±ÙˆÙ ØªØ¹Ø±ÙŠÙ", q:"Choose correct:", options:[
    {t:"I have a apple.", ok:false},
    {t:"I have an apple.", ok:true},
    {t:"I have the apple (first time).", ok:false}
  ]},
  { hint:"Ø§Ø³ØªØ¹Ù…Ø§Ù„Ø§Øª", q:"What is 'Could youâ€¦?' used for?", options:[
    {t:"Making a polite request", ok:true},
    {t:"Talking about the past only", ok:false},
    {t:"Giving commands", ok:false}
  ]},
  { hint:"Ù…Ø¹Ù†Ù‰", q:"'Iâ€™m looking forward to it' means:", options:[
    {t:"Iâ€™m excited about it", ok:true},
    {t:"Iâ€™m angry about it", ok:false},
    {t:"I donâ€™t care", ok:false}
  ]},
  { hint:"Ù‚ÙˆØ§Ø¹Ø¯", q:"Choose correct:", options:[
    {t:"He donâ€™t like tea.", ok:false},
    {t:"He doesnâ€™t like tea.", ok:true},
    {t:"He not like tea.", ok:false}
  ]},
  { hint:"Present Perfect", q:"Choose correct:", options:[
    {t:"I have finished my work.", ok:true},
    {t:"I has finished my work.", ok:false},
    {t:"I finish my work yesterday.", ok:false}
  ]},
  { hint:"Ù‚Ø±Ø§Ø¡Ø© Ù‚ØµÙŠØ±Ø©", q:"Choose best meaning: 'The meeting was postponed.'", options:[
    {t:"The meeting happened earlier.", ok:false},
    {t:"The meeting was delayed to a later time.", ok:true},
    {t:"The meeting was cancelled forever.", ok:false}
  ]},
  { hint:"ÙÙˆÙ‚ Ù…ØªÙˆØ³Ø·", q:"Choose correct:", options:[
    {t:"If I will have time, I will call you.", ok:false},
    {t:"If I have time, Iâ€™ll call you.", ok:true},
    {t:"If I time, I call you.", ok:false}
  ]},
  { hint:"ØªØ¹Ø¨ÙŠØ±", q:"'Iâ€™d rather stay home' means:", options:[
    {t:"I prefer to stay home", ok:true},
    {t:"I must stay home", ok:false},
    {t:"I hate staying home", ok:false}
  ]}
];

const curriculum = {
  A1: {
    grammar: [
      {
        title:"am / is / are (to be)",
        points:[
          "Ù†Ø³ØªØ®Ø¯Ù… am Ù…Ø¹ IØŒ Ùˆ is Ù…Ø¹ he/she/itØŒ Ùˆ are Ù…Ø¹ you/we/they.",
          "Ø£Ù…Ø«Ù„Ø©: <span class='en'>I am happy.</span> / <span class='en'>She is a doctor.</span> / <span class='en'>They are students.</span>"
        ],
        miniQuiz:{
          q:"Ø§Ø®ØªØ± Ø§Ù„ØµØ­ÙŠØ­:",
          options:[
            {t:"I is from Jordan.", ok:false},
            {t:"I am from Jordan.", ok:true},
            {t:"I are from Jordan.", ok:false}
          ]
        }
      },
      {
        title:"a / an",
        points:[
          "a Ù‚Ø¨Ù„ ØµÙˆØª Ø³Ø§ÙƒÙ†: <span class='en'>a book</span>",
          "an Ù‚Ø¨Ù„ ØµÙˆØª Ù…ØªØ­Ø±Ùƒ: <span class='en'>an apple</span>",
          "Ù…Ù‡Ù…: Ø§Ù„ØµÙˆØª Ù…Ø´ Ø§Ù„Ø­Ø±Ù! Ù…Ø«Ø§Ù„: <span class='en'>an hour</span> (h Ø³Ø§ÙƒØª)."
        ],
        miniQuiz:{
          q:"Ø§Ø®ØªØ± Ø§Ù„ØµØ­ÙŠØ­:",
          options:[
            {t:"a orange", ok:false},
            {t:"an orange", ok:true},
            {t:"the orange (first time)", ok:false}
          ]
        }
      }
    ],
    vocabSets: [
      { id:"a1_food", title:"Food (Ø£Ø³Ø§Ø³ÙŠØ§Øª)", items:[
        {word:"apple", meaning:"ØªÙØ§Ø­Ø©", example:"<span class='en'>I eat an apple.</span>"},
        {word:"water", meaning:"Ù…Ø§Ø¡", example:"<span class='en'>I drink water.</span>"},
        {word:"bread", meaning:"Ø®Ø¨Ø²", example:"<span class='en'>I buy bread.</span>"},
        {word:"rice", meaning:"Ø±Ø²", example:"<span class='en'>We cook rice.</span>"},
      ]},
      { id:"a1_daily", title:"Daily verbs", items:[
        {word:"go", meaning:"ÙŠØ°Ù‡Ø¨", example:"<span class='en'>I go to work.</span>"},
        {word:"eat", meaning:"ÙŠØ£ÙƒÙ„", example:"<span class='en'>They eat lunch.</span>"},
        {word:"sleep", meaning:"ÙŠÙ†Ø§Ù…", example:"<span class='en'>I sleep early.</span>"},
        {word:"study", meaning:"ÙŠØ¯Ø±Ø³", example:"<span class='en'>I study English.</span>"},
      ]}
    ],
    dialogues:[
      {
        title:"At a cafÃ©",
        lines:[
          {en:"Hi! Can I have a coffee, please?", ar:"Ù…Ø±Ø­Ø¨Ù‹Ø§! Ù…Ù…ÙƒÙ† Ù‚Ù‡ÙˆØ© Ù„Ùˆ Ø³Ù…Ø­ØªØŸ"},
          {en:"Sure. Anything else?", ar:"Ø£ÙƒÙŠØ¯. Ø´ÙŠØ¡ Ø¢Ø®Ø±ØŸ"},
          {en:"Yes, a sandwich, please.", ar:"Ù†Ø¹Ù…ØŒ Ø³Ø§Ù†Ø¯ÙˆÙŠØªØ´ Ù„Ùˆ Ø³Ù…Ø­Øª."}
        ]
      }
    ]
  },

  A2: {
    grammar: [
      {
        title:"Present Simple vs Present Continuous",
        points:[
          "Present Simple Ù„Ù„Ø±ÙˆØªÙŠÙ†: <span class='en'>I work every day.</span>",
          "Present Continuous Ù„Ù„Ø´ÙŠØ¡ Ø§Ù„Ø¢Ù†: <span class='en'>I am working now.</span>",
          "Ø¥Ø´Ø§Ø±Ø§Øª: <span class='en'>every day</span> / <span class='en'>now</span> / <span class='en'>at the moment</span>."
        ],
        miniQuiz:{
          q:"Ø§Ø®ØªØ± Ø§Ù„ØµØ­ÙŠØ­ (Ø§Ù„Ø¢Ù†):",
          options:[
            {t:"I work now.", ok:false},
            {t:"I am working now.", ok:true},
            {t:"I working now.", ok:false}
          ]
        }
      },
      {
        title:"Past Simple (regular/irregular)",
        points:[
          "Ø£ÙØ¹Ø§Ù„ Ù…Ù†ØªØ¸Ù…Ø©: +ed Ù…Ø«Ù„ <span class='en'>played</span>.",
          "ØºÙŠØ± Ù…Ù†ØªØ¸Ù…Ø©: <span class='en'>go â†’ went</span>, <span class='en'>see â†’ saw</span>.",
          "Ù…Ø«Ø§Ù„: <span class='en'>I went to the mall yesterday.</span>"
        ],
        miniQuiz:{
          q:"Past of 'go'?",
          options:[
            {t:"goed", ok:false},
            {t:"went", ok:true},
            {t:"go", ok:false}
          ]
        }
      }
    ],
    vocabSets: [
      { id:"a2_travel", title:"Travel", items:[
        {word:"ticket", meaning:"ØªØ°ÙƒØ±Ø©", example:"<span class='en'>I need a ticket.</span>"},
        {word:"hotel", meaning:"ÙÙ†Ø¯Ù‚", example:"<span class='en'>The hotel is nice.</span>"},
        {word:"passport", meaning:"Ø¬ÙˆØ§Ø² Ø³ÙØ±", example:"<span class='en'>Where is my passport?</span>"},
        {word:"map", meaning:"Ø®Ø±ÙŠØ·Ø©", example:"<span class='en'>Letâ€™s use a map.</span>"},
      ]}
    ],
    dialogues:[
      {
        title:"Asking for directions",
        lines:[
          {en:"Excuse me, where is the bus station?", ar:"Ø¹Ø°Ø±Ù‹Ø§ØŒ Ø£ÙŠÙ† Ù…Ø­Ø·Ø© Ø§Ù„Ø¨Ø§ØµØŸ"},
          {en:"Go straight, then turn left.", ar:"Ø§Ø°Ù‡Ø¨ Ù…Ø³ØªÙ‚ÙŠÙ…Ù‹Ø§ Ø«Ù… Ø§Ù†Ø¹Ø·Ù ÙŠØ³Ø§Ø±Ù‹Ø§."},
          {en:"Thank you!", ar:"Ø´ÙƒØ±Ù‹Ø§!"}
        ]
      }
    ]
  },

  B1: {
    grammar: [
      {
        title:"Present Perfect (have/has + V3)",
        points:[
          "Ù„Ù„Ø®Ø¨Ø±Ø©/Ø§Ù„Ù†ØªÙŠØ¬Ø©: <span class='en'>I have visited Aqaba.</span>",
          "Ù…Ø¹ <span class='en'>already / yet / just</span>.",
          "Ø³Ø¤Ø§Ù„: <span class='en'>Have you ever tried sushi?</span>"
        ],
        miniQuiz:{
          q:"Ø§Ø®ØªØ± Ø§Ù„ØµØ­ÙŠØ­:",
          options:[
            {t:"I have finish my work.", ok:false},
            {t:"I have finished my work.", ok:true},
            {t:"I finished my work yet.", ok:false}
          ]
        }
      },
      {
        title:"Modals for advice (should / shouldnâ€™t)",
        points:[
          "<span class='en'>You should</span> Ù„Ù„Ù†ØµÙŠØ­Ø©.",
          "<span class='en'>You shouldnâ€™t</span> Ù„Ù„ØªØ­Ø°ÙŠØ±.",
          "Ù…Ø«Ø§Ù„: <span class='en'>You should practice daily.</span>"
        ],
        miniQuiz:{
          q:"Ø§Ø®ØªØ± Ø§Ù„ØµØ­ÙŠØ­:",
          options:[
            {t:"You should to study.", ok:false},
            {t:"You should study.", ok:true},
            {t:"You should studying.", ok:false}
          ]
        }
      }
    ],
    vocabSets: [
      { id:"b1_work", title:"Work", items:[
        {word:"deadline", meaning:"Ù…ÙˆØ¹Ø¯ ØªØ³Ù„ÙŠÙ… Ù†Ù‡Ø§Ø¦ÙŠ", example:"<span class='en'>We have a deadline tomorrow.</span>"},
        {word:"meeting", meaning:"Ø§Ø¬ØªÙ…Ø§Ø¹", example:"<span class='en'>The meeting starts at 10.</span>"},
        {word:"task", meaning:"Ù…Ù‡Ù…Ø©", example:"<span class='en'>This task is important.</span>"},
        {word:"improve", meaning:"ÙŠØ­Ø³Ù‘Ù†", example:"<span class='en'>I want to improve my English.</span>"},
      ]}
    ],
    dialogues:[
      {
        title:"At work (polite)",
        lines:[
          {en:"Could you help me with this report?", ar:"Ù…Ù…ÙƒÙ† ØªØ³Ø§Ø¹Ø¯Ù†ÙŠ Ø¨Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ±ØŸ"},
          {en:"Sure, Iâ€™ll take a look.", ar:"Ø£ÙƒÙŠØ¯ØŒ Ø±Ø­ Ø£Ø´ÙˆÙÙ‡."},
          {en:"Thanks, I appreciate it.", ar:"Ø´ÙƒØ±Ù‹Ø§ØŒ Ø£Ù‚Ø¯Ù‘Ø± Ø°Ù„Ùƒ."}
        ]
      }
    ]
  },

  B2: {
    grammar: [
      {
        title:"Conditionals (If + present, will...)",
        points:[
          "Ù„Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„Ù…Ù…ÙƒÙ†: <span class='en'>If I have time, Iâ€™ll call you.</span>",
          "Ù„Ø§ Ù†Ø³ØªØ®Ø¯Ù… <span class='en'>will</span> Ø¨Ø¹Ø¯ <span class='en'>if</span> ØºØ§Ù„Ø¨Ù‹Ø§."
        ],
        miniQuiz:{
          q:"Ø§Ø®ØªØ± Ø§Ù„ØµØ­ÙŠØ­:",
          options:[
            {t:"If I will have time, Iâ€™ll call you.", ok:false},
            {t:"If I have time, Iâ€™ll call you.", ok:true},
            {t:"If I had time, I call you.", ok:false}
          ]
        }
      },
      {
        title:"Speaking upgrade: opinion + reason + example",
        points:[
          "Ù‚Ø§Ù„Ø¨ Ù…Ù…ØªØ§Ø²: <span class='en'>In my opinionâ€¦ becauseâ€¦ For exampleâ€¦</span>",
          "Ù…Ø«Ø§Ù„: <span class='en'>In my opinion, online learning is effective because it is flexible. For exampleâ€¦</span>"
        ],
        miniQuiz:{
          q:"Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù…Ù„Ø© Ø§Ù„Ø£Ù‚ÙˆÙ‰:",
          options:[
            {t:"Online learning good.", ok:false},
            {t:"In my opinion, online learning is effective because it is flexible.", ok:true},
            {t:"Online learning, I like.", ok:false}
          ]
        }
      }
    ],
    vocabSets: [
      { id:"b2_advanced", title:"Common advanced verbs", items:[
        {word:"postpone", meaning:"ÙŠØ¤Ø¬Ù„", example:"<span class='en'>They postponed the meeting.</span>"},
        {word:"prefer", meaning:"ÙŠÙØ¶Ù‘Ù„", example:"<span class='en'>I prefer tea to coffee.</span>"},
        {word:"recommend", meaning:"ÙŠÙˆØµÙŠ", example:"<span class='en'>I recommend this book.</span>"},
        {word:"avoid", meaning:"ÙŠØªØ¬Ù†Ø¨", example:"<span class='en'>Try to avoid distractions.</span>"},
      ]}
    ],
    dialogues:[
      {
        title:"Discussion (opinion)",
        lines:[
          {en:"What do you think about working remotely?", ar:"Ø´Ùˆ Ø±Ø£ÙŠÙƒ Ø¨Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù† Ø¨ÙØ¹Ø¯ØŸ"},
          {en:"In my opinion, it saves time because there is no commute.", ar:"Ø¨Ø±Ø£ÙŠÙŠ Ø¨ÙŠÙˆÙÙ‘Ø± ÙˆÙ‚Øª Ù„Ø£Ù†Ù‡ Ù…Ø§ ÙÙŠ Ù…ÙˆØ§ØµÙ„Ø§Øª."},
          {en:"Thatâ€™s a good point.", ar:"Ù†Ù‚Ø·Ø© Ù…Ù…ØªØ§Ø²Ø©."}
        ]
      }
    ]
  }
};

const practiceBank = {
  A1: [
    { type:"mcq", q:"Choose correct:", prompt:"<span class='en'>She ___ a student.</span>", options:[
      {t:"am", ok:false}, {t:"is", ok:true}, {t:"are", ok:false}
    ]},
    { type:"fill", q:"Fill the blank:", prompt:"<span class='en'>I ___ in Amman.</span>", answer:"live", tip:"Ø§Ø³ØªØ®Ø¯Ù… ÙØ¹Ù„ Ø¨Ø³ÙŠØ· (Present Simple)."},
    { type:"mcq", q:"Choose correct:", prompt:"<span class='en'>___ apple</span>", options:[
      {t:"a", ok:false}, {t:"an", ok:true}, {t:"the", ok:false}
    ]},
    { type:"fill", q:"Fill the blank:", prompt:"<span class='en'>They ___ happy.</span>", answer:"are", tip:"Ù…Ø¹ they Ù†Ø³ØªØ®Ø¯Ù… are."}
  ],
  A2: [
    { type:"mcq", q:"Choose correct:", prompt:"<span class='en'>I am ___ now.</span>", options:[
      {t:"work", ok:false},{t:"working", ok:true},{t:"worked", ok:false}
    ]},
    { type:"fill", q:"Fill the blank:", prompt:"<span class='en'>Yesterday I ___ to the market.</span>", answer:"went", tip:"go â†’ went"},
    { type:"mcq", q:"Choose correct:", prompt:"<span class='en'>He ___ like tea.</span>", options:[
      {t:"donâ€™t", ok:false},{t:"doesnâ€™t", ok:true},{t:"not", ok:false}
    ]},
    { type:"fill", q:"Fill the blank:", prompt:"<span class='en'>We ___ a hotel near the beach.</span>", answer:"booked", tip:"Past simple regular +ed."}
  ],
  B1: [
    { type:"mcq", q:"Choose correct:", prompt:"<span class='en'>I have ___ my homework.</span>", options:[
      {t:"finish", ok:false},{t:"finished", ok:true},{t:"finishing", ok:false}
    ]},
    { type:"fill", q:"Fill the blank:", prompt:"<span class='en'>You should ___ daily.</span>", answer:"practice", tip:"Ø¨Ø¹Ø¯ should ÙŠØ£ØªÙŠ ÙØ¹Ù„ base form."},
    { type:"mcq", q:"Choose correct:", prompt:"<span class='en'>Have you ever ___ sushi?</span>", options:[
      {t:"try", ok:false},{t:"tried", ok:true},{t:"trying", ok:false}
    ]},
    { type:"fill", q:"Fill the blank:", prompt:"<span class='en'>The meeting was ___ to next week.</span>", answer:"postponed", tip:"postpone â†’ postponed"}
  ],
  B2: [
    { type:"mcq", q:"Choose correct:", prompt:"<span class='en'>If I ___ time, Iâ€™ll call you.</span>", options:[
      {t:"will have", ok:false},{t:"have", ok:true},{t:"had", ok:false}
    ]},
    { type:"fill", q:"Fill the blank:", prompt:"<span class='en'>Iâ€™d rather ___ home today.</span>", answer:"stay", tip:"rather + base verb."},
    { type:"mcq", q:"Choose stronger sentence:", prompt:"", options:[
      {t:"Remote work good.", ok:false},
      {t:"In my opinion, remote work is effective because it improves work-life balance.", ok:true},
      {t:"Remote work I like.", ok:false}
    ]},
    { type:"fill", q:"Fill the blank:", prompt:"<span class='en'>Try to ___ distractions while studying.</span>", answer:"avoid", tip:"avoid = ÙŠØªØ¬Ù†Ø¨"}
  ]
};

/* -----------------------------
   Helpers
-------------------------------- */
function $(id){ return document.getElementById(id); }

function showToast(msg){
  $("toastMsg").innerText = msg;
  $("toast").classList.add("show");
  setTimeout(()=> hideToast(), 1800);
}
function hideToast(){ $("toast").classList.remove("show"); }

function todayKey(){
  const d = new Date();
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
}

function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

function speak(text){
  try{
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "en-US";
    u.rate = 0.95;
    speechSynthesis.cancel();
    speechSynthesis.speak(u);
  }catch(e){
    showToast("Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… Ù‡Ù†Ø§");
  }
}

/* -----------------------------
   Persistence
-------------------------------- */
function load(){
  const raw = localStorage.getItem(LS_KEY);
  if(!raw) return;
  try{
    const saved = JSON.parse(raw);

    // shallow merge safe
    Object.assign(state.profile, saved.profile || {});
    Object.assign(state.placement, saved.placement || {});
    Object.assign(state.progress, saved.progress || {});
    Object.assign(state.notes, saved.notes || {});
    if(saved.srs && Array.isArray(saved.srs.words)) state.srs.words = saved.srs.words;

    // onboardingStep if done
    if(saved.profile && saved.profile.level) {
      state.onboardingStep = 4;
      setOnboardingDoneUI();
    }

  }catch(e){}
}

function save(){
  localStorage.setItem(LS_KEY, JSON.stringify(state));
}

/* -----------------------------
   Onboarding UI
-------------------------------- */
function setStepper(step){
  state.onboardingStep = step;
  $("stepLabel").innerText = `Ø§Ù„Ø®Ø·ÙˆØ© ${step}/4`;

  const widths = [0,0,0,0].map((_,i)=> (i<step? 100: 15));
  $("dot1").style.width = widths[0]+"%";
  $("dot2").style.width = widths[1]+"%";
  $("dot3").style.width = widths[2]+"%";
  $("dot4").style.width = widths[3]+"%";

  // views
  ["step1","step2","step3","step4"].forEach((sid, idx)=>{
    const el = $(sid);
    el.classList.remove("active");
    el.style.display="none";
    if(idx===step-1){
      el.style.display="block";
      el.classList.add("active");
    }
  });

  save();
}

function calcLevelFromScore(score){
  // 12 Q
  if(score <= 3) return "A1";
  if(score <= 6) return "A2";
  if(score <= 9) return "B1";
  return "B2";
}

function focusWeights(goal, pain, minutes){
  // base
  let vocab=25, grammar=25, listen=25, speak=25;

  // goal tweaks
  if(goal==="conversation"){ speak+=15; listen+=10; grammar-=10; vocab-=15; }
  if(goal==="travel"){ vocab+=10; speak+=10; grammar-=5; listen-=15; }
  if(goal==="job"){ speak+=10; vocab+=10; grammar+=5; listen-=25; }
  if(goal==="study"){ grammar+=15; vocab+=10; listen+=5; speak-=30; }
  if(goal==="exam"){ grammar+=15; listen+=15; vocab+=10; speak-=40; }

  // pain tweaks
  if(pain==="speaking"){ speak+=15; grammar-=5; vocab-=5; listen-=5; }
  if(pain==="listening"){ listen+=18; speak+=6; vocab-=12; grammar-=12; }
  if(pain==="grammar"){ grammar+=18; vocab+=4; speak-=12; listen-=10; }
  if(pain==="vocab"){ vocab+=18; listen+=4; speak-=12; grammar-=10; }

  // normalize
  vocab = Math.max(10, vocab);
  grammar = Math.max(10, grammar);
  listen = Math.max(10, listen);
  speak = Math.max(10, speak);

  const sum = vocab+grammar+listen+speak;
  vocab = Math.round((vocab/sum)*100);
  grammar = Math.round((grammar/sum)*100);
  listen = Math.round((listen/sum)*100);
  speak = 100 - vocab - grammar - listen; // ensure 100

  // minutes doesn't change weights, only session blocks lengths later
  return {vocab, grammar, listen, speak};
}

function buildPlan(level, goal, minutes, pain){
  const w = focusWeights(goal, pain, minutes);

  // simple 4 weeks plan with increasing speaking/practice as level rises
  const weekFocus = [];
  for(let i=1;i<=4;i++){
    let challenge = (level==="A1"? "Ø£Ø³Ø§Ø³ÙŠØ§Øª" : level==="A2"? "Ø«Ø¨Ø§Øª" : level==="B1"? "Ø·Ù„Ø§Ù‚Ø©" : "Ø¯Ù‚Ø©");
    weekFocus.push({
      week:i,
      title:`Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${i}: ${challenge}`,
      bullets:[
        `Ø¬Ù„Ø³Ø© ÙŠÙˆÙ…ÙŠØ© ${minutes} Ø¯Ù‚ÙŠÙ‚Ø© (Ù…Ù‚Ø³Ù…Ø© Ø­Ø³Ø¨ Ù‡Ø¯ÙÙƒ).`,
        `Ù…ÙØ±Ø¯Ø§Øª + Ù…Ø±Ø§Ø¬Ø¹Ø© Ø°ÙƒÙŠØ© (SRS).`,
        `Ù‚ÙˆØ§Ø¹Ø¯ Ù‚ØµÙŠØ±Ø© + ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¨Ø§Ø´Ø±.`,
        `Ù…Ø­Ø§Ø¯Ø«Ø©/Ø¸Ù„ (Shadowing) Ø¹Ù„Ù‰ Ø¬ÙÙ…ÙÙ„ Ø¬Ø§Ù‡Ø²Ø©.`,
        `Ø§Ø®ØªØ¨Ø§Ø± Ù‚ØµÙŠØ± Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹.`
      ]
    });
  }

  return {weights:w, weeks:weekFocus};
}

function renderPlan(plan){
  const w = plan.weights;
  $("pVocab").innerText = w.vocab+"%";
  $("pGrammar").innerText = w.grammar+"%";
  $("pListen").innerText = w.listen+"%";
  $("pSpeak").innerText = w.speak+"%";
  $("barVocab").style.width = w.vocab+"%";
  $("barGrammar").style.width = w.grammar+"%";
  $("barListen").style.width = w.listen+"%";
  $("barSpeak").style.width = w.speak+"%";

  // focus label
  let focus = "Balanced";
  const maxKey = Object.entries(w).sort((a,b)=>b[1]-a[1])[0][0];
  if(maxKey==="vocab") focus="Vocabulary";
  if(maxKey==="grammar") focus="Grammar";
  if(maxKey==="listen") focus="Listening";
  if(maxKey==="speak") focus="Speaking";
  $("focusBadge").innerText = focus;

  // plan text
  const weeksHtml = plan.weeks.map(wk=>`
    <div style="border:1px solid var(--border); border-radius:14px; padding:12px; margin-top:10px; background:#fff;">
      <div style="font-weight:900; color:var(--navy);">${wk.title}</div>
      <ul class="clean">${wk.bullets.map(b=>`<li>${b}</li>`).join("")}</ul>
    </div>
  `).join("");

  $("planBox").innerHTML = weeksHtml;
  $("planFull").innerHTML = weeksHtml;
}

function setOnboardingDoneUI(){
  $("pillStatus").innerText = "Ù…ÙØ¹Ø¯ âœ…";
  $("tabsWrap").style.display = "block";
}

function goDashboard(){
  $("viewOnboarding").classList.remove("active");
  $("viewOnboarding").style.display = "none";
  $("viewDashboard").style.display = "block";
  $("viewDashboard").classList.add("active");
  setOnboardingDoneUI();
  renderDashboardAll();
  showTab("today");
  save();
}

/* -----------------------------
   Placement test UI
-------------------------------- */
function renderPlacementQuestion(){
  const idx = state.placement.index;
  const total = placementQuestions.length;
  const q = placementQuestions[idx];

  $("qTitle").innerHTML = q.q;
  $("qHint").innerText = `ğŸ“Œ ${q.hint}`;
  $("qCount").innerText = `${idx+1}/${total}`;

  const selected = state.placement.answers[idx];

  $("qOptions").innerHTML = q.options.map((o, i)=>{
    const picked = (selected === i);
    return `
      <div class="option" data-i="${i}">
        <div class="en" style="font-weight:900;">${o.t}</div>
        <small>${picked ? "âœ… Ø§Ø®ØªØ±ØªÙ‡Ø§" : "Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±"}</small>
      </div>
    `;
  }).join("");

  // click bind
  [...$("qOptions").querySelectorAll(".option")].forEach(el=>{
    el.addEventListener("click", ()=>{
      const i = +el.dataset.i;
      state.placement.answers[idx] = i;
      save();
      renderPlacementQuestion();
    });
  });

  $("qPrev").disabled = (idx===0);
  $("qPrev").style.opacity = (idx===0 ? .5 : 1);
}

function finalizePlacement(){
  let score = 0;
  placementQuestions.forEach((q, idx)=>{
    const a = state.placement.answers[idx];
    if(a===null) return;
    if(q.options[a].ok) score++;
  });
  state.profile.score = score;
  state.profile.level = calcLevelFromScore(score);

  // create initial SRS word pool based on level
  initSRSIfEmpty();

  // show result
  $("levelBadge").innerText = state.profile.level;

  const name = state.profile.name ? `ÙŠØ§ ${state.profile.name}ØŒ ` : "";
  $("resultText").innerHTML = `
    ${name}Ù…Ø³ØªÙˆØ§Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ: <b>${state.profile.level}</b> â€” ${LEVEL_DESC[state.profile.level]}
    <br><br>
    Ù‡Ø¯ÙÙƒ: <b>${GOALS_AR[state.profile.goal]}</b> â€” ÙˆÙ†Ù‚Ø·Ø© Ø¶Ø¹ÙÙƒ: <b>${PAIN_AR[state.profile.pain]}</b>.
    <br>
    Ø±Ø§Ø­ Ù†Ø¹Ø·ÙŠÙƒ Ø¬Ù„Ø³Ø© ÙŠÙˆÙ…ÙŠØ© Ø®Ø·ÙˆØ©-Ø¨Ø®Ø·ÙˆØ© + ØªÙ…Ø§Ø±ÙŠÙ† Ø¨ØªØµØ­ÙŠØ­ ÙÙˆØ±ÙŠ.
  `;

  $("planBadge").innerText = `${state.profile.minutes} Ø¯Ù‚ÙŠÙ‚Ø©/ÙŠÙˆÙ…`;

  const plan = buildPlan(state.profile.level, state.profile.goal, state.profile.minutes, state.profile.pain);
  renderPlan(plan);

  save();
}

/* -----------------------------
   SRS (Spaced Repetition)
-------------------------------- */
function initSRSIfEmpty(){
  if(state.srs.words.length>0) return;

  const level = state.profile.level || "A1";
  const sets = curriculum[level].vocabSets;
  const items = sets.flatMap(s=>s.items);

  const now = Date.now();
  state.srs.words = items.map((it, idx)=>({
    id: `${level}_${idx}_${it.word}`,
    word: it.word,
    meaning: it.meaning,
    example: it.example,
    box: 1,
    nextReviewTs: now // due now
  }));
  save();
}

function dueWords(){
  const now = Date.now();
  return state.srs.words.filter(w => (w.nextReviewTs || 0) <= now)
    .sort((a,b)=> (a.nextReviewTs||0) - (b.nextReviewTs||0));
}

function scheduleWord(wordObj, known){
  // known => advance box, hard => drop/keep low
  const now = Date.now();
  if(known){
    wordObj.box = clamp(wordObj.box + 1, 1, 5);
  }else{
    wordObj.box = clamp(wordObj.box - 1, 1, 5);
  }
  const days = intervalsDays[wordObj.box] ?? 7;
  wordObj.nextReviewTs = now + days*24*60*60*1000;
  state.progress.points += known ? 5 : 2;
  save();
}

/* -----------------------------
   Dashboard Rendering
-------------------------------- */
function showTab(name){
  // set tab active
  [...document.querySelectorAll(".tab")].forEach(t=>{
    t.classList.toggle("active", t.dataset.tab===name);
  });

  // show view
  ["today","plan","learn","practice","progress"].forEach(n=>{
    const el = $("tab_"+n);
    el.style.display = (n===name? "block" : "none");
  });

  const titles = {
    today:"Ø¬Ù„Ø³Ø© Ø§Ù„ÙŠÙˆÙ…",
    plan:"Ø§Ù„Ø®Ø·Ø©",
    learn:"Ø§Ù„ØªØ¹Ù„Ù‘Ù…",
    practice:"Ø§Ù„ØªØ¯Ø±ÙŠØ¨",
    progress:"Ø§Ù„ØªÙ‚Ø¯Ù‘Ù…"
  };
  $("dashTitle").innerText = titles[name] || "Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…";

  renderDashboardAll();
}

function updateProfileSide(){
  const p = state.profile;
  $("profileBadge").innerText = `${p.level} â€¢ ${p.minutes}m`;
  $("dashMeta").innerText = `${GOALS_AR[p.goal]} â€¢ ${PAIN_AR[p.pain]}`;

  const name = p.name ? `<b>${p.name}</b>` : `<b>Ù…Ø³ØªØ®Ø¯Ù…</b>`;
  $("profileBox").innerHTML = `
    ${name}<br>
    Ø§Ù„Ù…Ø³ØªÙˆÙ‰: <b>${p.level}</b><br>
    Ø§Ù„Ù‡Ø¯Ù: <b>${GOALS_AR[p.goal]}</b><br>
    ÙˆÙ‚ØªÙƒ: <b>${p.minutes} Ø¯Ù‚ÙŠÙ‚Ø©/ÙŠÙˆÙ…</b><br>
    Ù†Ù‚Ø§Ø·Ùƒ: <b>${state.progress.points}</b>
  `;
}

function ensureDailyStreak(){
  const today = todayKey();
  if(!state.progress.lastDay){
    state.progress.lastDay = today;
    state.progress.streak = 1;
    save();
    return;
  }
  if(state.progress.lastDay === today) return;

  // if consecutive day
  const last = new Date(state.progress.lastDay);
  const cur = new Date(today);
  const diffDays = Math.round((cur-last)/(24*60*60*1000));
  if(diffDays === 1){
    state.progress.streak += 1;
  }else{
    state.progress.streak = 1;
  }
  state.progress.lastDay = today;
  state.progress.todayPercent = 0;
  state.progress.sessionStep = 0;
  state.progress.practiceIndex = 0;
  state.progress.practiceAnswers = {};
  save();
}

function setTodayProgress(percent){
  state.progress.todayPercent = clamp(percent,0,100);
  $("todayBar").style.width = state.progress.todayPercent + "%";
  $("todayBadge").innerText = state.progress.todayPercent + "%";
  save();
}

function renderGrammarLesson(){
  const level = state.profile.level;
  const lessons = curriculum[level].grammar;
  const idx = (new Date().getDate()) % lessons.length;
  const lesson = lessons[idx];

  $("grammarTag").innerText = `${level} Grammar`;
  $("grammarLesson").innerHTML = `
    <div style="font-weight:900; color:var(--navy); margin-bottom:8px;">${lesson.title}</div>
    <ul class="clean">${lesson.points.map(p=>`<li>${p}</li>`).join("")}</ul>
    <div class="hr"></div>
    <div style="font-weight:900; color:var(--navy);">${lesson.miniQuiz.q}</div>
    ${lesson.miniQuiz.options.map((o,i)=>`
      <div class="option" data-gq="${i}"><span class="en">${o.t}</span></div>
    `).join("")}
    <div class="note" id="gqMsg"></div>
  `;

  // bind grammar mini quiz
  [...$("grammarLesson").querySelectorAll(".option[data-gq]")].forEach(el=>{
    el.addEventListener("click", ()=>{
      const i = +el.dataset.gq;
      const ok = lesson.miniQuiz.options[i].ok;
      $("gqMsg").innerHTML = ok
        ? `<span style="color:var(--ok); font-weight:900;">âœ… ØµØ­ÙŠØ­!</span>`
        : `<span style="color:var(--bad); font-weight:900;">âŒ Ø¬Ø±Ù‘Ø¨ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©.</span>`;
      if(ok){
        state.progress.points += 3;
        setTodayProgress(state.progress.todayPercent + 8);
        save();
      }
    });
  });

  // notes
  $("notesArea").value = state.notes.grammar || "";
}

function renderFlashcard(){
  initSRSIfEmpty();
  const due = dueWords();
  const wordObj = due[0] || state.srs.words[0];

  $("flashcard").innerHTML = `
    <div class="badge">ğŸ“Œ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¢Ù†</div>
    <div class="hr"></div>
    <div style="font-size:28px; font-weight:1000; color:var(--navy);" class="en">${wordObj.word}</div>
    <div style="margin-top:6px; font-weight:900;">Ø§Ù„Ù…Ø¹Ù†Ù‰: <span style="color:var(--text);">${wordObj.meaning}</span></div>
    <div style="margin-top:10px; padding:12px; border:1px dashed #cbd5e1; border-radius:14px; background:#fff;">
      <div style="font-weight:900; color:var(--navy); margin-bottom:6px;">Ù…Ø«Ø§Ù„:</div>
      <div>${wordObj.example}</div>
    </div>
    <div class="note">ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ØªÙƒØ±Ø§Ø±: <b>${wordObj.box}</b> (ÙƒÙ„ Ù…Ø§ ÙŠØ²ÙŠØ¯ØŒ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ØªØµÙŠØ± Ø£Ø¨Ø¹Ø¯)</div>
  `;

  // bind actions
  $("btnSpeakWord").onclick = ()=> speak(wordObj.word);
  $("btnKnown").onclick = ()=>{
    scheduleWord(wordObj, true);
    setTodayProgress(state.progress.todayPercent + 10);
    renderFlashcard();
    showToast("âœ… Ù…Ù…ØªØ§Ø²! Ø§Ù†Ø­Ø³Ø¨Øª Ù…ÙØ±Ø¯Ø©");
  };
  $("btnHard").onclick = ()=>{
    scheduleWord(wordObj, false);
    setTodayProgress(state.progress.todayPercent + 6);
    renderFlashcard();
    showToast("ğŸ¤¯ ØªÙ…Ø§Ù….. Ø±Ø¬Ø¹Ù†Ø§Ù‡Ø§ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ù‚Ø±ÙŠØ¨");
  };
}

function renderPractice(){
  const level = state.profile.level;
  const list = practiceBank[level];
  const idx = clamp(state.progress.practiceIndex, 0, list.length-1);
  const item = list[idx];

  $("practiceCount").innerText = `${idx+1}/${list.length}`;

  if(item.type==="mcq"){
    $("practiceBox").innerHTML = `
      <div style="font-weight:900; color:var(--navy);">${item.q}</div>
      ${item.prompt? `<div style="margin-top:8px; font-weight:900;">${item.prompt}</div>` : ""}
      <div class="hr"></div>
      ${item.options.map((o,i)=>`
        <div class="option" data-p="${idx}" data-i="${i}">
          ${item.prompt ? `<div class="en">${o.t}</div>` : `<div>${o.t}</div>`}
        </div>
      `).join("")}
      <div class="note" id="pMsg"></div>
    `;

    [...$("practiceBox").querySelectorAll(".option[data-i]")].forEach(el=>{
      el.addEventListener("click", ()=>{
        const i = +el.dataset.i;
        const ok = item.options[i].ok;
        state.progress.practiceAnswers[idx] = {type:"mcq", pick:i, ok};
        save();

        // visual feedback
        [...$("practiceBox").querySelectorAll(".option[data-i]")].forEach((oEl, j)=>{
          oEl.classList.remove("correct","wrong");
          if(j===i){
            oEl.classList.add(ok ? "correct" : "wrong");
          }
        });

        $("pMsg").innerHTML = ok
          ? `<span style="color:var(--ok); font-weight:900;">âœ… ØµØ­!</span>`
          : `<span style="color:var(--bad); font-weight:900;">âŒ ØºÙ„Ø·. Ø¬Ø±Ù‘Ø¨ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ© Ø£Ùˆ Ø§Ù†ØªÙ‚Ù„.</span>`;

        if(ok){
          state.progress.points += 4;
          setTodayProgress(state.progress.todayPercent + 8);
          save();
        }
      });
    });

  } else if(item.type==="fill"){
    $("practiceBox").innerHTML = `
      <div style="font-weight:900; color:var(--navy);">${item.q}</div>
      <div style="margin-top:8px; font-weight:900;">${item.prompt}</div>
      <div class="hr"></div>
      <label>Ø§ÙƒØªØ¨ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© (Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
      <input id="fillAns" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§..." class="en"/>
      <button class="btn" id="checkFill">ØªØ­Ù‚Ù‚ âœ…</button>
      <div class="note" id="fillMsg"></div>
      <div class="note">ØªÙ„Ù…ÙŠØ­: ${item.tip}</div>
    `;

    $("checkFill").onclick = ()=>{
      const user = ($("fillAns").value || "").trim().toLowerCase();
      const ans = item.answer.trim().toLowerCase();
      const ok = user === ans;

      state.progress.practiceAnswers[idx] = {type:"fill", user, ok};
      save();

      $("fillMsg").innerHTML = ok
        ? `<span style="color:var(--ok); font-weight:900;">âœ… Ù…Ù…ØªØ§Ø²!</span>`
        : `<span style="color:var(--bad); font-weight:900;">âŒ Ù…Ø´ ØµØ­. Ø§Ù„Ø¬ÙˆØ§Ø¨: <b class="en">${item.answer}</b></span>`;

      if(ok){
        state.progress.points += 5;
        setTodayProgress(state.progress.todayPercent + 10);
      }else{
        state.progress.points += 2;
        setTodayProgress(state.progress.todayPercent + 4);
      }
      save();
    };
  }

  $("pracPrev").disabled = (idx===0);
  $("pracPrev").style.opacity = (idx===0? .5 : 1);
  $("pracNext").innerText = (idx===list.length-1 ? "Ø¥Ù†Ù‡Ø§Ø¡ âœ…" : "Ø§Ù„ØªØ§Ù„ÙŠ â†’");
}

function renderProgressTab(){
  ensureDailyStreak();

  $("streakBadge").innerText = `ğŸ”¥ ${state.progress.streak} Ø£ÙŠØ§Ù…`;
  const due = dueWords();
  $("dueBadge").innerText = `${due.length} ÙƒÙ„Ù…Ø©`;

  $("progressSummary").innerHTML = `
    <ul class="clean">
      <li>Ù†Ù‚Ø§Ø·: <b>${state.progress.points}</b></li>
      <li>Streak: <b>${state.progress.streak}</b> ÙŠÙˆÙ…</li>
      <li>ØªÙ‚Ø¯Ù… Ø§Ù„ÙŠÙˆÙ…: <b>${state.progress.todayPercent}%</b></li>
      <li>Ù…Ø³ØªÙˆÙ‰: <b>${state.profile.level}</b></li>
      <li>Ù‡Ø¯Ù: <b>${GOALS_AR[state.profile.goal]}</b></li>
    </ul>
  `;

  if(due.length===0){
    $("dueWords").innerHTML = `<div class="muted">âœ… Ù…Ø§ ÙÙŠ ÙƒÙ„Ù…Ø§Øª Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¢Ù†. Ù…Ù…ØªØ§Ø²!</div>`;
  }else{
    $("dueWords").innerHTML = due.slice(0,8).map(w=>`
      <div style="border:1px solid var(--border); border-radius:14px; padding:10px; margin-top:10px;">
        <div class="en" style="font-weight:1000; color:var(--navy);">${w.word}</div>
        <div class="muted">Ø§Ù„Ù…Ø¹Ù†Ù‰: <b style="color:var(--text);">${w.meaning}</b> â€¢ ØµÙ†Ø¯ÙˆÙ‚: <b>${w.box}</b></div>
      </div>
    `).join("");
  }
}

function renderSessionStep(){
  const level = state.profile.level;
  const minutes = +state.profile.minutes;
  const plan = buildPlan(level, state.profile.goal, minutes, state.profile.pain);
  const w = plan.weights;

  // break minutes by weights (rounded)
  const blocks = {
    vocab: Math.max(3, Math.round(minutes * w.vocab / 100)),
    grammar: Math.max(3, Math.round(minutes * w.grammar / 100)),
    listen: Math.max(3, Math.round(minutes * w.listen / 100)),
    speak: Math.max(3, minutes - (Math.max(3, Math.round(minutes*w.vocab/100)) + Math.max(3, Math.round(minutes*w.grammar/100)) + Math.max(3, Math.round(minutes*w.listen/100))))
  };

  const steps = [
    { title:"1) Ø¥Ø­Ù…Ø§Ø¡ Ø³Ø±ÙŠØ¹ (60 Ø«Ø§Ù†ÙŠØ©)", body: `
      <div class="muted">Ø§Ù‚Ø±Ø£ Ø§Ù„Ø¬Ù…Ù„Ø© Ø¨ØµÙˆØª Ø¹Ø§Ù„ÙŠ 3 Ù…Ø±Ø§Øª (Shadowing):</div>
      <div style="margin-top:10px; padding:12px; border:1px solid var(--border); border-radius:14px;">
        <div class="en" style="font-weight:1000; font-size:18px;">Today I will practice English step by step.</div>
        <div class="muted" style="margin-top:6px;">Ø§Ù„ÙŠÙˆÙ… Ø±Ø­ Ø£ØªØ¯Ø±Ù‘Ø¨ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©.</div>
      </div>
      <div style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;">
        <button class="btn secondary" onclick="speak('Today I will practice English step by step.')">ğŸ”Š Ø§Ø³ØªÙ…Ø¹</button>
      </div>
      <div class="note">âœ… Ø§Ù„Ù‡Ø¯Ù: ØªØ¬Ù‡Ù‘Ø² Ù„Ø³Ø§Ù†Ùƒ Ù„Ù„Ù†Ø·Ù‚.</div>
    `},
    { title:`2) Ù…ÙØ±Ø¯Ø§Øª (${blocks.vocab} Ø¯Ù‚Ø§Ø¦Ù‚)`, body: `
      <div class="muted">Ø±Ø§Ø¬ÙØ¹ ÙƒÙ„Ù…Ø© ÙˆØ§Ø­Ø¯Ø© Ø§Ù„Ø¢Ù† (SRS) + Ù‚Ù„ Ø§Ù„Ù…Ø«Ø§Ù„ Ø¨ØµÙˆØªÙƒ.</div>
      <div class="hr"></div>
      <div id="sessionVocab"></div>
      <div style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;">
        <button class="btn secondary" id="svSpeak">ğŸ”Š Ø§Ø³ØªÙ…Ø¹ Ù„Ù„ÙƒÙ„Ù…Ø©</button>
        <button class="btn" id="svKnown">Ø¹Ø±ÙØªÙ‡Ø§ âœ…</button>
        <button class="btn secondary" id="svHard">ØµØ¹Ø¨Ø© ğŸ¤¯</button>
      </div>
    `},
    { title:`3) Ù‚ÙˆØ§Ø¹Ø¯ (${blocks.grammar} Ø¯Ù‚Ø§Ø¦Ù‚)`, body: `
      <div class="muted">Ø§Ù‚Ø±Ø£ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© + Ø¬Ø§ÙˆØ¨ Ø³Ø¤Ø§Ù„ ØµØºÙŠØ±.</div>
      <div class="hr"></div>
      <div id="sessionGrammar"></div>
    `},
    { title:`4) Ø§Ø³ØªÙ…Ø§Ø¹/Ù†Ø·Ù‚ (${blocks.listen} Ø¯Ù‚Ø§Ø¦Ù‚)`, body: `
      <div class="muted">Ø§Ø³Ù…Ø¹ Ø§Ù„Ø­ÙˆØ§Ø± ÙˆÙƒØ±Ø± Ø¬Ù…Ù„Ø© Ø¬Ù…Ù„Ø©.</div>
      <div class="hr"></div>
      <div id="sessionDialogue"></div>
    `},
    { title:`5) ØªØ·Ø¨ÙŠÙ‚/Ù…Ø­Ø§Ø¯Ø«Ø© (${blocks.speak} Ø¯Ù‚Ø§Ø¦Ù‚)`, body: `
      <div class="muted">Ø§ÙƒØªØ¨ Ø±Ø¯Ùƒ (Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ). Ø«Ù… Ø§Ø¶ØºØ· Ø§Ø³ØªÙ…Ø¹ Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¬ÙˆØ§Ø¨.</div>
      <div class="hr"></div>
      <div id="sessionSpeaking"></div>
    `}
  ];

  const s = clamp(state.progress.sessionStep, 0, steps.length-1);
  const step = steps[s];

  $("sessionBox").innerHTML = `
    <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
      <div style="font-weight:1000; color:var(--navy); font-size:16px;">${step.title}</div>
      <span class="badge">${s+1}/5</span>
    </div>
    <div style="margin-top:10px;">${step.body}</div>
  `;

  // Inject dynamic content per step
  if(s===1){
    initSRSIfEmpty();
    const wordObj = (dueWords()[0] || state.srs.words[0]);
    $("sessionVocab").innerHTML = `
      <div class="badge">ÙƒÙ„Ù…Ø© Ø§Ù„ÙŠÙˆÙ…</div>
      <div class="hr"></div>
      <div class="en" style="font-weight:1000; font-size:26px; color:var(--navy);">${wordObj.word}</div>
      <div style="margin-top:6px; font-weight:900;">Ø§Ù„Ù…Ø¹Ù†Ù‰: ${wordObj.meaning}</div>
      <div style="margin-top:10px; padding:12px; border:1px dashed #cbd5e1; border-radius:14px;">
        <div style="font-weight:900; color:var(--navy); margin-bottom:6px;">Ù…Ø«Ø§Ù„:</div>
        <div>${wordObj.example}</div>
      </div>
    `;
    $("svSpeak").onclick = ()=> speak(wordObj.word);
    $("svKnown").onclick = ()=>{
      scheduleWord(wordObj, true);
      setTodayProgress(state.progress.todayPercent + 12);
      renderSessionStep();
      showToast("âœ… Ù…Ù…ØªØ§Ø²! Ø­ÙØ¸Ù†Ø§ ØªÙ‚Ø¯Ù… Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª");
    };
    $("svHard").onclick = ()=>{
      scheduleWord(wordObj, false);
      setTodayProgress(state.progress.todayPercent + 8);
      renderSessionStep();
      showToast("ğŸ¤¯ ØªÙ…Ø§Ù….. Ø±Ø§Ø­ Ù†ÙƒØ±Ø±Ù‡Ø§ Ù‚Ø±ÙŠØ¨");
    };
  }

  if(s===2){
    const lessons = curriculum[level].grammar;
    const idx = (new Date().getDay()) % lessons.length;
    const lesson = lessons[idx];
    $("sessionGrammar").innerHTML = `
      <div style="font-weight:1000; color:var(--navy); margin-bottom:8px;">${lesson.title}</div>
      <ul class="clean">${lesson.points.map(p=>`<li>${p}</li>`).join("")}</ul>
      <div class="hr"></div>
      <div style="font-weight:1000; color:var(--navy);">${lesson.miniQuiz.q}</div>
      ${lesson.miniQuiz.options.map((o,i)=>`
        <div class="option" data-sg="${i}"><span class="en">${o.t}</span></div>
      `).join("")}
      <div class="note" id="sgMsg"></div>
    `;
    [...$("sessionGrammar").querySelectorAll(".option[data-sg]")].forEach(el=>{
      el.addEventListener("click", ()=>{
        const i = +el.dataset.sg;
        const ok = lesson.miniQuiz.options[i].ok;
        $("sgMsg").innerHTML = ok
          ? `<span style="color:var(--ok); font-weight:1000;">âœ… ØµØ­!</span>`
          : `<span style="color:var(--bad); font-weight:1000;">âŒ Ø¬Ø±Ù‘Ø¨ ØªØ§Ù†ÙŠ.</span>`;
        if(ok){
          state.progress.points += 4;
          setTodayProgress(state.progress.todayPercent + 10);
          save();
        }
      });
    });
  }

  if(s===3){
    const ds = curriculum[level].dialogues;
    const d = ds[(new Date().getDate()) % ds.length];
    $("sessionDialogue").innerHTML = `
      <div class="badge">Ø­ÙˆØ§Ø±: ${d.title}</div>
      <div class="hr"></div>
      ${d.lines.map((ln, i)=>`
        <div style="border:1px solid var(--border); border-radius:14px; padding:12px; margin-top:10px;">
          <div class="en" style="font-weight:1000;">${ln.en}</div>
          <div class="muted" style="margin-top:6px;">${ln.ar}</div>
          <div style="display:flex; gap:10px; margin-top:10px; flex-wrap:wrap;">
            <button class="btn secondary" onclick="speak(${JSON.stringify(ln.en)})">ğŸ”Š Ø§Ø³ØªÙ…Ø¹</button>
          </div>
        </div>
      `).join("")}
      <div class="note">âœ… ÙƒØ±Ø± ÙƒÙ„ Ø¬Ù…Ù„Ø© 2â€“3 Ù…Ø±Ø§Øª Ø¨ØµÙˆØªÙƒ.</div>
    `;
  }

  if(s===4){
    const promptsByGoal = {
      conversation: "Ø§ÙƒØªØ¨ 2â€“3 Ø¬ÙÙ…Ù„ Ø¹Ù† ÙŠÙˆÙ…Ùƒ Ø§Ù„ÙŠÙˆÙ….",
      travel: "Ø§ÙƒØªØ¨ Ø¬Ù…Ù„ØªÙŠÙ† ØªØ·Ù„Ø¨ ÙÙŠÙ‡Ù… Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø£Ùˆ Ø­Ø¬Ø² ÙÙ†Ø¯Ù‚.",
      job: "Ø§ÙƒØªØ¨ Ø¬Ù…Ù„ØªÙŠÙ† ØªØ¹Ø±Ù ÙÙŠÙ‡Ø§ Ø¹Ù† Ù†ÙØ³Ùƒ ÙÙŠ Ù…Ù‚Ø§Ø¨Ù„Ø©.",
      study: "Ø§ÙƒØªØ¨ Ø¬Ù…Ù„ØªÙŠÙ† Ø¹Ù† ØªØ®ØµØµÙƒ ÙˆÙ„Ù…Ø§Ø°Ø§ ØªØ¯Ø±Ø³Ù‡.",
      exam: "Ø§ÙƒØªØ¨ Ø¬Ù…Ù„Ø© Opinion + because + example."
    };
    const prompt = promptsByGoal[state.profile.goal] || promptsByGoal.conversation;

    const modelAnswers = {
      conversation: "Today I feel good. I will practice English for 30 minutes.",
      travel: "Excuse me, where is the nearest hotel? Iâ€™d like to book a room for two nights.",
      job: "I have experience in customer service. I am a fast learner and I work well in a team.",
      study: "I study computer science because I enjoy solving problems. I want to build useful apps.",
      exam: "In my opinion, online learning is effective because it is flexible. For example, students can study anytime."
    };

    $("sessionSpeaking").innerHTML = `
      <div style="font-weight:1000; color:var(--navy);">Ù…Ù‡Ù…Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©:</div>
      <div class="muted" style="margin-top:6px;">${prompt}</div>
      <label>Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ (Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
      <textarea id="spkAnswer" class="en" placeholder="Type here..."></textarea>
      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <button class="btn" id="saveSpk">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© âœ…</button>
        <button class="btn secondary" id="listenModel">ğŸ”Š Ø§Ø³Ù…Ø¹ Ù†Ù…ÙˆØ°Ø¬ Ø¬ÙˆØ§Ø¨</button>
      </div>
      <div class="note" id="spkMsg"></div>
    `;

    $("listenModel").onclick = ()=> speak(modelAnswers[state.profile.goal] || modelAnswers.conversation);
    $("saveSpk").onclick = ()=>{
      const txt = ($("spkAnswer").value || "").trim();
      if(!txt){
        $("spkMsg").innerHTML = `<span style="color:var(--warn); font-weight:1000;">âš ï¸ Ø§ÙƒØªØ¨ Ø´ÙŠØ¡ Ø¨Ø³ÙŠØ· Ø­ØªÙ‰ Ù„Ùˆ Ø¬Ù…Ù„Ø© ÙˆØ§Ø­Ø¯Ø©.</span>`;
        return;
      }
      state.progress.points += 6;
      setTodayProgress(state.progress.todayPercent + 18);
      save();
      $("spkMsg").innerHTML = `<span style="color:var(--ok); font-weight:1000;">âœ… Ø§Ù†Ø­ÙØ¸Øª. Ù…Ù…ØªØ§Ø²!</span>`;
      showToast("âœ… Ø®Ù„ØµØª ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©");
    };
  }

  // buttons
  $("sessionBack").disabled = (s===0);
  $("sessionBack").style.opacity = (s===0 ? .5 : 1);

  $("sessionNext").innerText = (s===4 ? "Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø© âœ…" : "Ø§Ù„ØªØ§Ù„ÙŠ â†’");
}

function renderDashboardAll(){
  ensureDailyStreak();
  updateProfileSide();
  setTodayProgress(state.progress.todayPercent);

  // plan
  const plan = buildPlan(state.profile.level, state.profile.goal, state.profile.minutes, state.profile.pain);
  renderPlan(plan);

  // learn tab pieces
  renderGrammarLesson();
  renderFlashcard();
  renderPractice();
  renderProgressTab();
  renderSessionStep();
}

/* -----------------------------
   Events
-------------------------------- */
function initEvents(){
  // Reset
  $("btnReset").onclick = ()=>{
    localStorage.removeItem(LS_KEY);
    location.reload();
  };

  // Tabs
  $("tabs").addEventListener("click", (e)=>{
    const btn = e.target.closest(".tab");
    if(!btn) return;
    showTab(btn.dataset.tab);
  });

  // onboarding step navigation
  $("goStep2").onclick = ()=>{
    state.profile.name = $("inpName").value.trim();
    state.profile.minutes = +$("inpMinutes").value;
    save();
    setStepper(2);
  };
  $("back1").onclick = ()=> setStepper(1);

  $("goStep3").onclick = ()=>{
    state.profile.goal = $("inpGoal").value;
    state.profile.pain = $("inpPain").value;
    save();
    setStepper(3);
    state.placement.index = 0;
    renderPlacementQuestion();
  };

  $("qPrev").onclick = ()=>{
    state.placement.index = clamp(state.placement.index-1, 0, placementQuestions.length-1);
    save();
    renderPlacementQuestion();
  };

  $("qNext").onclick = ()=>{
    const idx = state.placement.index;
    // require answer
    if(state.placement.answers[idx] === null){
      showToast("Ø§Ø®ØªØ§Ø± Ø¥Ø¬Ø§Ø¨Ø© Ø£ÙˆÙ„Ø§Ù‹ âš ï¸");
      return;
    }
    if(idx < placementQuestions.length-1){
      state.placement.index += 1;
      save();
      renderPlacementQuestion();
    }else{
      // done
      finalizePlacement();
      setStepper(4);
      save();
    }
  };

  $("backToTest").onclick = ()=>{
    setStepper(3);
    renderPlacementQuestion();
  };

  $("finishOnboarding").onclick = ()=>{
    setOnboardingDoneUI();
    save();
    goDashboard();
  };

  // session controls
  $("sessionBack").onclick = ()=>{
    state.progress.sessionStep = clamp(state.progress.sessionStep-1, 0, 4);
    save();
    renderSessionStep();
  };

  $("sessionNext").onclick = ()=>{
    if(state.progress.sessionStep < 4){
      state.progress.sessionStep += 1;
      save();
      renderSessionStep();
    }else{
      // finish session
      state.progress.points += 10;
      setTodayProgress(Math.max(state.progress.todayPercent, 100));
      save();
      renderSessionStep();
      showToast("ğŸ‰ Ø®Ù„ØµØª Ø¬Ù„Ø³Ø© Ø§Ù„ÙŠÙˆÙ…!");
      showTab("progress");
    }
  };

  // practice nav
  $("pracPrev").onclick = ()=>{
    state.progress.practiceIndex = clamp(state.progress.practiceIndex-1, 0, practiceBank[state.profile.level].length-1);
    save();
    renderPractice();
  };
  $("pracNext").onclick = ()=>{
    const list = practiceBank[state.profile.level];
    if(state.progress.practiceIndex < list.length-1){
      state.progress.practiceIndex += 1;
      save();
      renderPractice();
    }else{
      showToast("âœ… Ø®Ù„ØµØª Ø§Ù„ØªØ¯Ø±ÙŠØ¨!");
      setTodayProgress(state.progress.todayPercent + 12);
      showTab("progress");
    }
  };

  // notes
  $("saveNotes").onclick = ()=>{
    state.notes.grammar = $("notesArea").value;
    save();
    showToast("âœ… Ø­ÙØ¸Ù†Ø§ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ");
  };

  // quick jumps
  $("jumpToday").onclick = ()=> showTab("today");
  $("jumpVocab").onclick = ()=> showTab("learn");
  $("jumpPractice").onclick = ()=> showTab("practice");

  // export
  $("btnExport").onclick = ()=>{
    const data = JSON.stringify(state, null, 2);
    $("exportBox").innerHTML = `<div class="note">Ø§Ù†Ø³Ø® Ù‡Ø°Ø§ ÙˆØ§Ø­ÙØ¸Ù‡ Ø¹Ù†Ø¯Ùƒ:</div><pre style="direction:ltr; background:#0b1220; color:#e5e7eb; padding:12px; border-radius:14px; overflow:auto; max-height:220px;">${escapeHtml(data)}</pre>`;
  };
}

/* -----------------------------
   Utils
-------------------------------- */
function escapeHtml(str){
  return str
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;");
}

/* -----------------------------
   Boot
-------------------------------- */
load();
initEvents();

// onboarding initial values
$("inpName").value = state.profile.name || "";
$("inpMinutes").value = String(state.profile.minutes || 30);
$("inpGoal").value = state.profile.goal || "conversation";
$("inpPain").value = state.profile.pain || "speaking";

// if already set up
if(state.profile.level){
  setOnboardingDoneUI();
  $("viewOnboarding").style.display="none";
  $("viewOnboarding").classList.remove("active");
  $("viewDashboard").style.display="block";
  $("viewDashboard").classList.add("active");
  renderDashboardAll();
} else {
  // fresh
  setStepper(1);
}
</script>
</body>
</html>
